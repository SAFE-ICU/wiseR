---
title: "wiseR: Helping your decisions from complex datasets"
author: "Shubham Maheshwari, Anant Mittal, Tavpritesh Sethi"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{An Introduction to wiseR. using a validated network as example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Wiser is an interactive,end-to-end Bayesian Network Analysis and publishing platform for learning cross-validated structure, inferences, topology, visualization in interventional and observational data. It is powered by shiny, bnlearn and visNetwork packages.

# Getting Started
To install latest developmental version of wiseR in R

```c
devtools::install_github('SAFE-ICU/wiseR')
```

To launch the app:

```c
wiseR::wiser()
```
#Bayesian Networks

#wiseR Functionalities
##Start

<img src="1.png" height="300px" width="650px" />

On launching the App we are greeted with the home page.The app then starts initializing UI components which may take 1-2 seconds. First time launch may experience more delay as the app checks and installs all the necessary dependencies required. Clicking on start analyzing redirects us to the main page, containing app utilities in a tab fashion.

The ordering of the tab has been maintained in a left to right fashion based on flow of use in bayesian learning. The main page has 5 tabs named 'App Settings','Data','Association Network','Bayesian Network' and 'Publish your dashboard', each tab covering a specific functionality.

##App Settings

<img src="2.png" height="100px" width="650px" />

This tab is used to set the computation settings of the app. Bayesian learning on complex data is often computationally expensive and time consuming, thus we enable the user to run computationally expensive processes in parallel, and also to choose the number of clusters (Parallel nodes) to form which they can select based on their hardware.

##Data

<img src="3.png" height="300px" width="650px" />

This tab is used to load, pre-process and explore the dataset user wants to work with before learning begins.

The dataset panel contains the upload and preprocess menu while explore panel is used to visualize the distribution of the data.

###Upload

<img src="4.png" height="300px" width="650px" />

Using upload menu user can either load pre-existing data or upload data of their own. Available file formats of data are '.CSV','.RData' & '.txt'. For '.txt' files different options of file formatting are provided such as:

* Comma Separated
* Semi-colon Seperated
* Tab separated
* Space Separated

The default setting of the app is to consider variables in the dataset as factors by default. This can be un-selected based on user need.

Current limit of file upload is 8000 mb, however it is recommended to use .RData for large datasets.

###Pre-process

<img src="5.png" height="300px" width="650px" />

The preprocess menu is used to edit the data before using through the app. It is essential that data is discrete and complete for learning association network and bayesian network. Multiple options to pre-process the data have been provided.

* User can convert any variable which has been misclassified as numeric to factor
* User can convert any variable which has been misclassified as factor to numeric
* User can choose from a number of algorithms to discretize their data - Hybrid(Recommended),Hartemink(Recommended),K-means,Quantile,Frequency,Interval
* Hartemink requires 2 parameters 'break' and 'ibreak' which can be passed using the text input boxes.
* user can also transpose their data frame, which is especially useful in case of gene expression data
* User is also given the option to sort the columns of data alphabetically
* User can also select unnecessary variables and delete them from the data using the delete button. A rest button is also provided to undo the delete operations in case of mistakes.
* Option for adjusting the learning for interventional data is also provided. User can simply select the variable which holds the interventional classification and adjust the learning to it.


###Download

<img src="6.png" height="300px" width="650px" />

This button is provided in case the user wants to download the dataset in current state as a .CSV file

###Explore

<img src="7.png" height="300px" width="650px" />

This section is provided to visualize the distribution of the variables in the dataset.
Once the data has been pre-processes(Discretized and complete), the user can select a variable and visualize the plot of its factor distribution.

##Association Network

<img src="8.png" height="300px" width="650px" />

Even though not directly related association networks are an essential part of bayesian learning. Bayesian networks are often large and complex, which makes the difficult to understand. Learning association networks on the data before bayesian learning can give useful insights from the simplistic structure produced and provides a more targeted approach to bayesian learning.

The app provides multiple options to build and explore association networks.

###Build

<img src="9.png" height="300px" width="650px" />

The build menu is used to build association networks. It consists of different metrics for association strength which are used to build association networks like

* cramer's V(Recommended)
* cohen's D
* Goodman kruskal lambda
* Tschuprow's T

Each method returns a value between 0 and 1. 0 being two variables are not associated and 1 being highly associated. A threshold value between 0 and 1 can then be set to choose the edges that remain in the association graph based on strength of association.

###Detect Modules

<img src="10.png" height="300px" width="650px" />

Often large graphs are difficult to explore and contain redundant information. To enable a clutter less analysis feature for module/community detection is provided which highlights different important groups of subgraphs in the original graph. These graphs can be individually explored and analysed.

There are different clustering algorithms available in the app for module/community detection which is powered by linkcomm package, like ward.D (Recommended),ward.D2,single,complete,average,mcquitty, median,centroid for user to choose from.

###Visual settings

<img src="11.png" height="300px" width="650px" />

The visual settings menu is used to exploit the graph for better exploration. It comes equipped with many features like variable grouping, which enables the user to group different nodes, by selecting variable names/vector of variable indices/variables belonging to a module and selecting a node shape they want to give these variables.

To ease the exploration of large graphs a threshold for visible neighbor chain is provided, such that clicking on a node only display its neighbors upto that degree.

Another neighborhood variable exploration mechanism is setting value for nth order neighbors, such that clicking on a variable return a list of nth degree neighbors.

User also has the option to arrange the graph nodes using different graph layouts.Depending on the graph different layout setups enable ease of exploration. Some useful layouts include mds, tree, sugiyama

###Export tables

<img src="12.png" height="300px" width="650px" />

This section is used to visualize the association network produced in a tabular form and also to download it as a .CSV file if needed.

##Bayesian Network

<img src="13.png" height="300px" width="650px" />

Multiple features have been clubbed into the bayesian learning component of the app to make it as useful as possible. This component of the app is powered by the bnlearn package and tries to cover all the innovative and efficient methods for structure learning as explained in the book.

###Structure learning
The structure learning menu incorporates all the need for bayesian learning and has been divided into 5 sections based on use.

####Initialize structure

<img src="14.png" height="300px" width="650px" />

This section enables the user to upload a network graph as a .CSV file to initialize the bayesian learning graph. The section also provides the user the option to add, remove or reverse the direction of any arc, once the graph has been uploaded.

####Learn Structure

<img src="15.png" height="300px" width="650px" />

This section is used to learn new bayesian structure through the app.

The user can choose from a number of bayesian learning algorithms such as

* Score-based (Recommended):- Hill Climbing, Tabu
* Constraint-based:- Grow-Shrink, Incremental Association, Fast IAMB, Inter IAMB,PC
* Hybrid Learning:- Max-Min Hill Climbing, 2-phase Restricted Maximization
* Local Discovery:- Max-Min Parents and Children,Semi-Interleaved HITON-PC, ARACNE, Chow-Liu

and can also adjust other bayesian learning parameters such as:

* Parameter fitting algorithm:- Bayesian parameter estimation, maximum likelihood parameter estimation
* Network score:- Bayesian Information Criterion,Bayesian Dirichlet Equivalent,modified Bayesian Dirichlet Equivalent,log-likelihood,Akaike Information Criterion,Bayesian Dirichlet Sparse,Locally Averaged Bayesian Dirichlet
* Imaginary sample size
* Blacklist(explicitly restrict edges in structure learning) and whitelist(explicitly enforce edges in structure learning) edges by uploading a .CSV file for the same
* Bootstrap iterations:- No. of bootstrap iteration to run in case user decided to opt for bootstrapped structure learning
* Bootstrap sample size:- Proportion of data to be used as sample for bootstrap learning
* Edge strength:- Set a threshold value between 0 and 1 to remove edges below that strength from the final structure. Edge strength is basically the probability of occurrence of an edge in each iteration of bootstrap learning
_ Edge direction:- set threshold value between o and 1 to remove edges below that direction confidence from the final structure. Edge direction is basically the confidence of direction of a learned arc in bootstrap learning.

The user can simple choose the do direct learning or do a bootstrapped one(in which case bootstrap parameters will be used) for more robust structure learning.

Once structure has been learned, parameters such as parameter fitting algorithm and edge strength and direction threshold(For bootstrap learning) can be adjusted without having to re learn the structure through parameter tuning option.

User can also save the learned structure as a bnlearn object in .RData format through the save option.

####Upload pre-learnt structure

<img src="16.png" height="300px" width="650px" />

This section enables the user to upload an already bayesian structure to be explore through the app. This save the user hassle of learning the structure again and again. The upload structure has to be a bnlearn object uploaded as a .RData file.

User has option to upload both simple and bootstrap structure and adjust there parameters accordingly

####Edit structure

<img src="17.png" height="300px" width="650px" />

This section enables the user to edit the structure after learning to incorporate additional expert knowledge. User can add new arcs to the structure and remove, reverse the existing ones.

####Validate structure

<img src="18.png" height="300px" width="650px" />

This section enable user the option to validate the learned structure, and check the accuracy of the network. User can choose various parameters such as

* Parameter fitting algorithm
* Network score
* Loss function
* Validation algorithm:- 10-fold, Hold-out

to validate the network. The log-likelihood loss and network score outputs produced can then be used to judge the usability of the learned structure.

###Inference Learning

<img src="19.png" height="300px" width="650px" />

The inference learning menu enables the user to learn and explore conditional probability plots on the learned structure. The user can set an event  and multiple evidences can be inserted and removed as per need. This crucial feature enables the user to explore probability plots on event nodes in the network conditionalized on chain of evidences, which is the essence of decision making through bayesian networks.

The app provides 2 means for inference learning

* Approximate (Very fast but sampling based inference, thus varying results on each iteration leading to slightly less accurate probability plots)
* Exact inference (Fast for small networks, slow for large networks but accurate results on each iteration)

While the app learns approximate learning as default, user must explicitly learn exact inferences whenever the structure is learned or updated. The user can than enable exact inferences instead of approximate.

To compensate for wavering accuracy of approximate inference while retaining its speed, option for inference with error bars is given. User can provide the no. of iterations for error plot (Recommended 25). It is observed that the inference plots produced using approximate inference with error bars, is almost as accurate as exact inference, without the time constraint of exact inferences on large networks.

Apart from structure learning and inference learning the bayesian network tab is divided into 4 sections for visualization and exploration

<img src="20.png" height="300px" width="650px" />

* Bayesian network panel is used to explore the learned structure and is equipped with all the graph exploration features as available in association graph

<img src="21.png" height="300px" width="650px" />

* Fitted local distribution panel is used to explore the local probability distribution tables of variables in the learned network structure

<img src="22.png" height="300px" width="650px" />

* Infer decisions is used to visualize the inference plots once the user has chosen the event and evidence nodes. It also has option to sort the plot axis and prune the no. of plot bars

<img src="23.png" height="300px" width="650px" />

* Export tables section is used to visualize the network graph, blacklist-whitelist edges and variable wise validation results in tabular format. User can also download these tables as .CSV file


##Publish your dashboard

<img src="24.png" height="300px" width="650px" />

This section is one of the key highlights of the app. Often user find it difficult effectively communicate their results on bayesian learning. This app enables the user to produce a custom dashboard of their results as an R package.

The user has options to select the name and theme for the dashboard, the app simply builds the dashboard for them which is downloadable as an R package through the app. The custom dashboard is equipped with flagship features of wiseR like the interactive graph exploration and inference learning and visualization.

This feature save author hassle of creating a dashboard for their findings, and helps propagating research output to the community in an efficient manner, which is the main motive behind wiser i.e bridging the gap between the research community and technology.

#Example
We explain the usefulness of bayesian networks by replicating the results presented in Sachs et al. (2005), which utilizes bayesian learning on complex interventional data.

We upload the sachs interventional data which is in a space separated text file into the app.
Variables are read as factors as it is a numerically encoded discrete data



The variable INT hold interventional information, adjustment is made for the same in the preprocess menu.













